/* d4-rails includes d4 library to provide DSL for d3 for Rails applications
 * License: MIT
 */
/*! d4 - v0.5.8
 *  License: MIT Expat
 *  Date: 2014-03-24
 */
/*!
  Functions "each", "extend", and "isFunction" based on Underscore.js 1.5.2
  http://underscorejs.org
  (c) 2009-2014 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
  Underscore may be freely distributed under the MIT license.
*/
(function(){/*!
   * global d3: false
   * global d4: false
   */
"use strict";var t=this,e={},n=function(t){return t instanceof n?t:this instanceof n?(this.d4Wrapped=t,void 0):new n(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=n),exports.d4=n):t.d4=n,n.charts={},n.features={},n.parsers={},n.builders={};var r=n.each=n.forEach=function(t,n,r){var s,i,a=Array.prototype.forEach;if(null!==t)if(a&&t.forEach===a)t.forEach(n,r);else if(t.length===+t.length){for(s=0,i=t.length;i>s;s++)if(n.call(r,t[s],s,t)===e)return}else{var c=d3.keys(t);for(s=0,i=c.length;i>s;s++)if(n.call(r,t[c[s]],c[s],t)===e)return}},s=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},i=function(t,e,r,s){Object.defineProperty(t,e,{configurable:!0,get:function(){return n.functor(s)()},set:function(){a(" You cannot directly assign values to the {0} property. Instead use the {1}() function.",e,r)}})},a=function(){var t,e=Array.prototype.slice.call(arguments),n=e.shift();throw r(e,function(e,r){t=RegExp("\\{"+r+"\\}","gi"),n=n.replace(t,e)}),Error("[d4] "+n)},c=function(t){return r(["link"],function(e){(!t[e]||n.isNotFunction(t[e]))&&a("The supplied builder does not have a {0} function",e)}),t},u=function(t){return this.builder||(this.builder=c(t.bind(this)())),this},o=function(t,e,r){if(n.isNotFunction(r)){var s="$"+e;i(t,s,e,r)}},d=function(t,e,n,r){var i=n;r!==void 0&&(i=r+s(n)),t[i]=function(r){return arguments.length?(o(t,n,r),e[n]=r,t):e[n]},o(t,n,e[n])},l=function(t,e,n,s){r(n,function(n){d(t,e,n,s)})},h=function(t){var e=t.accessors;e&&l(t,t.accessors,d3.keys(e))},f=function(t,e){r(d3.keys(e.axes),function(n){t[n]=function(r){return Y.bind(e)(n,r),t},r(d3.keys(e.axes[n].accessors),function(r){t[n][r]=e.axes[n][r]})})},y=function(t){var e=d3.keys(d3.scale);0>e.indexOf(t)&&a('The scale type: "{0}" is unrecognized. D4 only supports these scale types: {1}',t,e.join(", "))},x=function(t,e,r){n.createAccessorProxy(e,t),e.scale=function(t){return arguments.length?(e.accessors.scale=t,r(),e):e.accessors.scale}},b=function(t,e,n){y(n.accessors.scale);var s=d3.scale[n.accessors.scale]();h(n),e[t]=s,x(s,e.axes[t],function(){b(t,e,n)}),r(d3.keys(e.axes[t].accessors),function(n){i(e[t],"$"+n,e.axes[t][n],e.axes[t][n])})},v=function(t,e,r){e.axes[t]={accessors:n.extend({key:t,min:void 0,max:void 0},r)},b(t,e,e.axes[t])},p=function(t){r(d3.keys(t.axes),function(e){v(e,t,t.axes[e])}),t.axes.x===void 0&&v("x",t,{scale:"ordinal"}),t.axes.y===void 0&&v("y",t,{scale:"linear"})},g=function(t,e){var r=n.functor({link:function(t,e){n.builders[t.x.$scale+"ScaleForNestedData"](t,e,"x"),n.builders[t.y.$scale+"ScaleForNestedData"](t,e,"y")}}),s=n.merge({width:400,height:400,features:{},mixins:[],axes:{},margin:{top:20,right:20,bottom:40,left:40}},t);return p(s),u.bind(s)(e||r),s.accessors=["margin","width","height","valueKey"].concat(d3.keys(t.accessors)||[]),s},m=function(t,e){e&&r(d3.keys(t._proxiedFunctions),function(n){r(t._proxiedFunctions[n],function(t){e[n].apply(e,t)})})},k=function(t,e,r){var s=t.features[e];return n.isFunction(s.prepare)&&(r=s.prepare.bind(t)(r),r===void 0&&a('"feature.prepare()" must return a data array. However, the prepare function for the "{0}" feature did not',e)),r},$=function(t,e){t.mixins.forEach(function(n){e=k(t,n,e);var r=t.features[n].render.bind(t)(t.features[n],e);m(t.features[n],r)})},A=function(t,e){t.builder?(t.builder.link(t,e),$(t,e)):a("No builder defined")},w=function(t,e){this.svg=d3.select(t).selectAll("svg").data([e]),this.featuresGroup=this.svg.enter().append("svg").append("g").attr("class","featuresGroup").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.svg.attr("width",this.width+this.margin.left+this.margin.right).attr("height",this.height+this.margin.top+this.margin.bottom).attr("class","d4"),this.svg.selectAll("defs").data([0]).enter().append("defs")},C=function(t,e){var r=n.parsers.nestedGroup().x(t.x.$key).y(t.y.$key).nestKey(t.x.$key).value(t.valueKey)(e);return r.data},z=function(t,e){t.valueKey===void 0&&(t.valueKey=t.y.$key);var r,s,i=!1;return e.length>0&&(s=e[0],n.isArray(s)?i=!0:(r=d3.keys(s),0>=r.indexOf("key")+r.indexOf("values")&&(i=!0))),i?C(t,e):e},L=function(){this._calculated||(this.width=this.width-this.margin.left-this.margin.right,this.height=this.height-this.margin.top-this.margin.bottom,this._calculated=!0)},S=function(t){return function(e){e.each(function(e){e=z(t,e),L.bind(t,this)(),w.bind(t,this)(e),A(t,e)})}},M=function(t,e){return t.overrides?t.overrides(e):{}},B=function(t,e,n){n!==void 0?(n=Math.max(Math.min(n,t.length),0),t.splice(n,0,e)):t.push(e)},K=function(t){t._proxiedFunctions={on:[]},t.on=function(){t._proxiedFunctions.on.push(Array.prototype.slice.call(arguments))}},N=function(t){h(t)},F=function(t){K(t),n.each(t.proxies,function(e){n.createAccessorProxy(t,e)})},G=function(t,e){t||a("You need to supply an object to mixin.");var r=d3.keys(t)[0],s=M.bind(this)(t,r),i={proxies:[]};t[r]=n.merge(n.merge(i,t[r](r)),s),n.extend(this.features,t),B(this.mixins,r,e),F(this.features[r]),N(this.features[r])},E=function(t){t||a("A name is required in order to mixout a chart feature."),delete this.features[t],this.mixins=this.mixins.filter(function(e){return e!==t})},T=function(t,e){var r=this.features[t];n.isNotFunction(e)&&a("You must supply a continuation function in order to use a chart feature."),r?e.bind(this)(r):a('Could not find feature: "{0}", maybe you forgot to mix it in?',t)},Y=function(t,e){var r=this.axes[t];n.isNotFunction(e)&&a("You must supply a continuation function in order to use a chart axis."),r?e.bind(this)(r):a('Could not find axis: "{0}", maybe you forgot to define it?',t)};n.baseChart=function(t){var e=g(t&&t.config||{},t&&t.builder||void 0),n=S(e);return l(n,e.margin,d3.keys(e.margin),"margin"),n.accessors=e.accessors,l(n,e,n.accessors),f(n,e),n.builder=function(t){return e.builder=c(t.bind(e)()),n},n.features=function(){return e.mixins},n.mixin=function(t,r){return G.bind(e)(t,r),n},n.mixout=function(t,r){return E.bind(e)(t,r),n},n.axes=function(t){return arguments.length?(t(e.axes),n):e.axes},n.using=function(t,r){return T.bind(e)(t,r),n},n},n.builder=function(t,e){return n.builders[t]=e,n.builders[t]},n.chart=function(t,e){return n.charts[t]=e,n.charts[t]},n.createAccessorProxy=function(t,e,n){r(d3.keys(e),function(r){var i=r;n!==void 0&&(i=n+s(r)),t[i]=function(){return arguments.length?(e[r].$dirty=!0,t[i].$dirty=!0,/*!
         * Instead of returning the target object we must return the proxy, this
         * is so that we do not break the functional programming chaining of
         * proxy function calls. Unfortunately, this also means that the results
         * of the target function are not captured. Ideally, it would be nice
         * to return the value of the target command if the target object
         * itself is not returned.
         */
e[r].apply(e,arguments),t):e[r]()},e[r].$dirty=!1,t[i].$dirty=!1})},n.extend=function(t){return r(Array.prototype.slice.call(arguments,1),function(e){if(e)for(var r in e)e[r]&&e[r].constructor&&e[r].constructor===Object?(t[r]=t[r]||{},n.extend(t[r],e[r])):t[r]=e[r]}),t},n.feature=function(t,e){return n.features[t]=e,n.features[t]},n.functor=function(t){return n.isFunction(t)?t:function(){return t}},n.isArray=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},n.isFunction=function(t){return!!(t&&t.constructor&&t.call&&t.apply)},n.isNotFunction=function(t){return!n.isFunction(t)},n.merge=function(t,e){return n.extend(n.extend({},t),e)},n.parser=function(t,e){return n.parsers[t]=e,n.parsers[t]}}).call(this),function(){/*!
   * global d3: false
   * global d4: false
   */
"use strict";d4.helpers={};var t=function(t,e){var n=5,r=0,s=function(t,e){return!(t.right<e.left||t.left>e.right||t.bottom<e.top||t.top>e.bottom)},i=function(t){var a,c,u,o=!1,d=0;t.each(function(){d>0&&(a=this.getBoundingClientRect(),c=u.getBoundingClientRect(),s(a,c)&&(e.bind(this)(c,a),o=!0)),d++,u=this}),o&&n>r&&(r++,i.bind(this)(t))};i.bind(this)(t)};d4.helpers.staggerTextVertically=function(e,n){var r=function(t,e){var r=d3.select(this),s=r.attr("data-last-vertical-offset")||1,i=t.top-e.top,a=(e.height-i+s)*n;r.attr("transform","translate(0,"+a+")"),r.attr("data-last-vertical-offset",Math.abs(a))};t.bind(this)(e,r)},d4.helpers.rotateText=function(t){return function(e){e.each(function(){var n=d3.transform(d3.functor(t).apply(this,arguments));e.attr("alignment-baseline","central"),e.style("dominant-baseline","central"),90>=n.rotate&&n.rotate>=-90?(e.attr("text-anchor","begin"),e.attr("transform",""+n)):(e.attr("text-anchor","end"),n.rotate=(n.rotate>0?-1:1)*(180-Math.abs(n.rotate)),e.attr("transform",""+n))})}},d4.helpers.staggerTextHorizontally=function(e,n){var r=function(t,e){var r=d3.select(this),s=r.attr("data-last-horizontal-offset")||1,i=t.left-e.left,a=(e.width-i+s)*n;r.attr("transform","translate("+a+", 0)"),r.attr("data-last-horizontal-offset",Math.abs(a))};t.bind(this)(e,r)},d4.helpers.textSize=function(t,e){var n={height:0,width:0,x:0,y:0};if(t!==void 0){var r=d3.select("body").append("svg").attr("class",""+e);r.append("text").attr("x",-5e3).text(t),n=r.node().getBBox(),r.remove()}return n},d4.helpers.wrapText=function(t,e){t.each(function(){var t,n=d3.select(this),r=n.text().split(/\s+/).reverse(),s=[],i=0,a=1.1,c=n.attr("x"),u=n.attr("y"),o=parseFloat(n.attr("dy")),d=n.text(null).append("tspan").attr("x",c).attr("y",u).attr("dy",o+"em");for(t=r.pop();t;)s.push(t),d.text(s.join(" ")),d.node().getComputedTextLength()>e-Math.abs(c)&&(s.pop(),d.text(s.join(" ")),s=[t],d=n.append("tspan").attr("x",c).attr("y",u).attr("dy",++i*a+o+"em").text(t)),t=r.pop()})}}.call(this),function(){/*!
   * global d3: false
   * global d4: false
   */
"use strict";d4.chart("column",function(){var t=d4.baseChart();return[{bars:d4.features.stackedColumnSeries},{barLabels:d4.features.stackedColumnLabels},{xAxis:d4.features.xAxis},{yAxis:d4.features.yAxis}].forEach(function(e){t.mixin(e)}),t})}.call(this),function(){/*!
   * global d3: false
   * global d4: false
   */
"use strict";d4.chart("groupedColumn",function(){var t=function(){return{accessors:{x:function(t,e){var n=this.x.rangeBand()/this.groupsOf,r=this.x(t[this.x.$key])+n*e,s=.1*n;return r+n/2-s}}}},e=d4.baseChart({config:{accessors:{groupsOf:1}}});return[{bars:d4.features.groupedColumnSeries},{barLabels:d4.features.stackedColumnLabels,overrides:t},{xAxis:d4.features.xAxis},{yAxis:d4.features.yAxis}].forEach(function(t){e.mixin(t)}),e})}.call(this),function(){/*!
   * global d3: false
   * global d4: false
   */
"use strict";d4.chart("line",function(){var t=d4.baseChart();return[{lineSeries:d4.features.lineSeries},{xAxis:d4.features.xAxis},{yAxis:d4.features.yAxis},{lineSeriesLabels:d4.features.lineSeriesLabels}].forEach(function(e){t.mixin(e)}),t})}.call(this),function(){/*!
   * global d3: false
   * global d4: false
   */
"use strict";d4.chart("row",function(){var t=d4.baseChart({config:{margin:{top:20,right:40,bottom:20,left:40},valueKey:"x",axes:{x:{scale:"linear"},y:{scale:"ordinal"}}}});return[{bars:d4.features.stackedColumnSeries},{barLabels:d4.features.stackedColumnLabels},{xAxis:d4.features.xAxis},{yAxis:d4.features.yAxis}].forEach(function(e){t.mixin(e)}),t})}.call(this),function(){/*!
   * global d3: false
   * global d4: false
   */
"use strict";var t=function(){var t=function(t,e){d4.builders[t.x.$scale+"ScaleForNestedData"](t,e,"x"),d4.builders[t.y.$scale+"ScaleForNestedData"](t,e,"y"),d4.builders[t.z.$scale+"ScaleForNestedData"](t,e,"z");var n=5,r=Math.max(n+1,(t.height-t.margin.top-t.margin.bottom)/10);t.z.range([n,r])},e={link:function(e,n){t.bind(this)(e,n)}};return e};d4.chart("scatterPlot",function(){var e=d4.baseChart({builder:t,config:{axes:{x:{scale:"linear"},z:{scale:"linear"}}}});return[{circles:d4.features.dotSeries},{circleLabels:d4.features.stackedColumnLabels},{xAxis:d4.features.xAxis},{yAxis:d4.features.yAxis}].forEach(function(t){e.mixin(t)}),e})}.call(this),function(){/*!
   * global d3: false
   * global d4: false
   */
"use strict";d4.chart("stackedColumn",function(){var t=function(){var t=function(t){var e=[];return t.map(function(t){t.values.map(function(t){e.push(t)})}),e},e=function(t){return d3.nest().key(function(t){return t[this.x.$key]}.bind(this)).rollup(function(t){var e=d3.sum(t,function(t){return t[this.valueKey]}.bind(this)),n=d3.sum(t,function(t){return Math.max(0,t[this.valueKey])}.bind(this));return{text:e,size:n}}.bind(this)).entries(t)},n=function(n){return e.bind(this)(t(n)).map(function(t){var e={};return e[this.x.$key]=t.key,e.size=t.values.size,e[this.valueKey]=t.values.text,e}.bind(this))};return{accessors:{y:function(t){var e=5;return this.y(t.size)-e}},prepare:function(t){return n.bind(this)(t)}}},e=d4.baseChart();return[{bars:d4.features.stackedColumnSeries},{barLabels:d4.features.stackedColumnLabels},{connectors:d4.features.stackedColumnConnectors},{columnTotals:d4.features.columnLabels,overrides:t},{xAxis:d4.features.xAxis},{yAxis:d4.features.yAxis}].forEach(function(t){e.mixin(t)}),e})}.call(this),function(){/*!
   * global d3: false
   * global d4: false
   */
"use strict";d4.chart("stackedRow",function(){var t=function(){var t=function(t){var e=[];return t.map(function(t){t.values.map(function(t){e.push(t)})}),e},e=function(t){return d3.nest().key(function(t){return t[this.y.$key]}.bind(this)).rollup(function(t){var e=d3.sum(t,function(t){return t[this.valueKey]}.bind(this)),n=d3.sum(t,function(t){return Math.max(0,t[this.valueKey])}.bind(this));return{text:e,size:n}}.bind(this)).entries(t)},n=function(n){return e.bind(this)(t(n)).map(function(t){var e={};return e[this.y.$key]=t.key,e.size=t.values.size,e[this.valueKey]=t.values.text,e}.bind(this))};return{accessors:{x:function(t){var e=5;return this.x(t.size)+e}},prepare:function(t){return n.bind(this)(t)}}},e=d4.baseChart({config:{margin:{top:20,right:40,bottom:20,left:40},axes:{x:{scale:"linear"},y:{scale:"ordinal"}}}});return[{bars:d4.features.stackedColumnSeries},{barLabels:d4.features.stackedColumnLabels},{connectors:d4.features.stackedColumnConnectors},{columnTotals:d4.features.columnLabels,overrides:t},{xAxis:d4.features.xAxis},{yAxis:d4.features.yAxis}].forEach(function(t){e.mixin(t)}),e})}.call(this),function(){/*!
   * global d3: false
   * global d4: false
   */
"use strict";var t=function(){return{accessors:{y:function(t){if("linear"===this.y.$scale){var e=t.y0+t.y-Math.min(0,t.y);return this.y(e)}return this.y(t[this.y.$key])},x:function(t){if("ordinal"===this.x.$scale)return this.x(t[this.x.$key]);var e=t.y0+t.y-Math.max(0,t.y);return this.x(e)},width:function(t){return"ordinal"===this.x.$scale?this.x.rangeBand():Math.abs(this.x(t.y0)-this.x(t.y0+t.y))},height:function(t){return"linear"===this.y.$scale?Math.abs(this.y(t.y0)-this.y(t.y0+t.y)):this.y.rangeBand()},classes:function(t,e,n){var r=t.y>0?"positive":"negative";return n>0&&0===t.y0&&(r="subtotal"),"bar fill item"+e+" "+r+" "+t[this.y.$key]}}}},e=function(){return{accessors:{y:function(t){if("linear"===this.y.$scale){var e=Math.abs(this.y(t.y0)-this.y(t.y0+t.y)),n=t.y0+t.y-Math.max(0,t.y);return this.y(n)-10-e}return this.y(t[this.y.$key])+this.y.rangeBand()/2},x:function(t){if("ordinal"===this.x.$scale)return this.x(t[this.x.$key])+this.x.rangeBand()/2;var e=t.y0+t.y-Math.max(0,t.y),n=Math.abs(this.x(t.y0)-this.x(t.y0+t.y));return this.x(e)+10+n},text:function(t){return d3.format("").call(this,t[this.valueKey])}}}},n=function(){var t=function(t,e){var n;return"x"===e?[0,t.width]:(n=[0,t.height],"ordinal"===t.x.$scale?n.reverse():n)},e=function(e,n,r){var s=r.map(function(t){return t.key}.bind(this));e[n].domain(s).rangeRoundBands(t.bind(this)(e,n),e.xRoundBands||.3)},n=function(e,n,r){var s=d3.extent(d3.merge(r.map(function(t){return d3.extent(t.values,function(t){return t.y+t.y0})})));s[0]=Math.min(0,s[0]),e[n].domain(s),e[n].range(t.bind(this)(e,n)).clamp(!0).nice()},r=function(t,r){"ordinal"===t.x.$scale?(e.bind(this)(t,"x",r),n.bind(this)(t,"y",r)):(e.bind(this)(t,"y",r),n.bind(this)(t,"x",r))},s={link:function(t,e){r.bind(this)(t,e)}};return s};d4.chart("waterfall",function(){var r=d4.baseChart({builder:n});return[{bars:d4.features.stackedColumnSeries,overrides:t},{connectors:d4.features.waterfallConnectors},{columnLabels:d4.features.stackedColumnLabels,overrides:e},{xAxis:d4.features.xAxis},{yAxis:d4.features.yAxis}].forEach(function(t){r.mixin(t)}),r})}.call(this),function(){/*!
   * global d3: false
   * global d4: false
   */
"use strict";d4.feature("arrow",function(t){return{accessors:{tipSize:function(){return 6},x1:function(){return this.x(0)},x2:function(){return this.x(this.width)},y1:function(){return this.y(0)},y2:function(){return this.y(this.height)},classes:function(){return"line"}},render:function(e){var n=this.svg.select("defs");n.append("marker").attr("id",t+"-end").attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerWidth",e.accessors.tipSize.bind(this)).attr("markerHeight",e.accessors.tipSize.bind(this)).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z"),n.append("marker").attr("id",t+"-start").attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerWidth",-e.accessors.tipSize.bind(this)()).attr("markerHeight",e.accessors.tipSize.bind(this)).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z"),this.featuresGroup.append("g").attr("class",t);var r=this.svg.select("."+t).append("line").attr("class",e.accessors.classes.bind(this)).attr("x1",e.accessors.x1.bind(this)).attr("x2",e.accessors.x2.bind(this)).attr("y1",e.accessors.y1.bind(this)).attr("y2",e.accessors.y2.bind(this)).attr("marker-end","url(#"+t+"-end)");return r}}})}.call(this),function(){/*!
   * global d3: false
   * global d4: false
   */
"use strict";d4.feature("columnLabels",function(t){var e=5,n=function(){return"ordinal"!==this.y.$scale?"middle":"start"};return{accessors:{x:function(t){return this.x(t[this.x.$key])+this.x.rangeBand()/2},y:function(t){if("ordinal"===this.y.$scale)return this.y(t[this.y.$key])+this.y.rangeBand()/2+e;var n=Math.abs(this.y(t[this.y.$key])-this.y(0));return(0>t[this.y.$key]?this.y(t[this.y.$key])-n:this.y(t[this.y.$key]))-e},text:function(t){return d3.format("").call(this,t[this.valueKey])}},render:function(e,r){this.featuresGroup.append("g").attr("class",t);var s=this.svg.select("."+t).selectAll("."+t).data(r,function(t,e){return t.key+e});return s.enter().append("text"),s.exit().remove(),s.attr("class","column-label").text(d4.functor(e.accessors.text).bind(this)).attr("text-anchor",n.bind(this)).attr("x",d4.functor(e.accessors.x).bind(this)).attr("y",d4.functor(e.accessors.y).bind(this)),s}}})}.call(this),function(){/*!
   * global d3: false
   * global d4: false
   */
"use strict";d4.feature("dotSeries",function(t){return{accessors:{cx:function(t){return this.x(t[this.x.$key])},cy:function(t){return this.y(t[this.y.$key])},r:function(t){return this.z(t[this.z.$key])},classes:function(t,e){return"dot series"+e+" fill"}},render:function(e,n){this.featuresGroup.append("g").attr("class",t);var r=this.svg.select("."+t).selectAll("g").data(n).enter().append("g").attr("class",function(t,e){return"series"+e+" "+this.y.$key}.bind(this)),s=r.selectAll("circle").data(function(t){return t.values}.bind(this));return s.enter().append("circle"),s.exit().remove(),s.attr("class",d4.functor(e.accessors.classes).bind(this)).attr("r",d4.functor(e.accessors.r).bind(this)).attr("cx",d4.functor(e.accessors.cx).bind(this)).attr("cy",d4.functor(e.accessors.cy).bind(this)),s}}})}.call(this),function(){/*!
   * global d3: false
   * global d4: false
   */
"use strict";d4.feature("grid",function(t){return{accessors:{formatXAxis:function(t){return t.orient("bottom")},formatYAxis:function(t){return t.orient("left")}},render:function(e){var n=d3.svg.axis().scale(this.x),r=d3.svg.axis().scale(this.y),s=d4.functor(e.accessors.formatXAxis).bind(this)(n),i=d4.functor(e.accessors.formatYAxis).bind(this)(r);this.featuresGroup.append("g").attr("class","grid border "+t).attr("transform","translate(0,0)").append("rect").attr("x",0).attr("y",0).attr("width",this.width).attr("height",this.height),this.featuresGroup.append("g").attr("class","x grid "+t).attr("transform","translate(0,"+this.height+")").call(s.tickSize(-this.height,0,0).tickFormat("")),this.featuresGroup.append("g").attr("class","y grid "+t).attr("transform","translate(0,0)").call(i.tickSize(-this.width,0,0).tickFormat(""))}}})}.call(this),function(){/*!
   * global d3: false
   * global d4: false
   */
"use strict";d4.feature("groupedColumnSeries",function(t){var e=function(t){return t>0?"positive":"negative"};return{accessors:{x:function(t,e){var n=this.x.rangeBand()/this.groupsOf,r=this.x(t[this.x.$key])+n*e;return r},y:function(t){return 0>t[this.y.$key]?this.y(0):this.y(t[this.y.$key])},width:function(){var t=this.x.rangeBand()/this.groupsOf,e=.1*t;return t-e},height:function(t){return Math.abs(this.y(t[this.y.$key])-this.y(0))},classes:function(t,n){return"bar fill item"+n+" "+e(t[this.y.$key])+" "+t[this.y.$key]}},render:function(e,n){this.featuresGroup.append("g").attr("class",t);var r=this.svg.select("."+t).selectAll("g").data(n,function(t,e){return t.key+e});r.enter().append("g"),r.exit().remove(),r.attr("class",function(t,e){return"series"+e+" "+this.x.$key}.bind(this));var s=r.selectAll("rect").data(function(t){return t.values}.bind(this));return s.enter().append("rect").attr("class",d4.functor(e.accessors.classes).bind(this)).attr("x",d4.functor(e.accessors.x).bind(this)).attr("y",d4.functor(e.accessors.y).bind(this)).attr("width",d4.functor(e.accessors.width).bind(this)).attr("height",d4.functor(e.accessors.height).bind(this)),s}}})}.call(this),function(){/*!
   * global d3: false
   * global d4: false
   */
"use strict";d4.feature("lineSeriesLabels",function(t){return{accessors:{x:function(t){return this.x(t.values[t.values.length-1][this.x.$key])},y:function(t){return this.y(t.values[t.values.length-1][this.y.$key])},text:function(t){return t.key},classes:function(t,e){return"stroke series"+e}},render:function(e,n){this.featuresGroup.append("g").attr("class",t);var r=this.svg.select("."+t).selectAll("."+t).data(n);return r.enter().append("text"),r.exit().remove(),r.attr("class","lineSeriesLabel").text(d4.functor(e.accessors.text).bind(this)).attr("x",d4.functor(e.accessors.x).bind(this)).attr("y",d4.functor(e.accessors.y).bind(this)).attr("data-key",function(t){return t.key}).attr("class",d4.functor(e.accessors.classes).bind(this)),r}}})}.call(this),function(){/*!
   * global d3: false
   * global d4: false
   */
"use strict";d4.feature("lineSeries",function(t){var e=d3.svg.line();return e.interpolate("basis"),{accessors:{x:function(t){return this.x(t[this.x.$key])},y:function(t){return this.y(t[this.y.$key])},classes:function(t,e){return"line stroke series"+e}},proxies:[e],render:function(n,r){this.featuresGroup.append("g").attr("class",t),e.x(d4.functor(n.accessors.x).bind(this)).y(d4.functor(n.accessors.y).bind(this));var s=this.svg.select("."+t).selectAll("g").data(r);s.exit().remove(),s.enter().append("g").attr("data-key",function(t){return t.key}).attr("class",d4.functor(n.accessors.classes).bind(this)).append("path").attr("d",function(t){return e(t.values)})}}})}.call(this),function(){/*!
   * global d3: false
   * global d4: false
   */
"use strict";d4.feature("referenceLine",function(t){return{accessors:{x1:function(){return this.x(0)},x2:function(){return this.x(this.width)},y1:function(){return this.y(0)},y2:function(){return this.y(this.height)},classes:function(){return"line"}},render:function(e){this.featuresGroup.append("g").attr("class",t);var n=this.svg.select("."+t).append("line").attr("class",d4.functor(e.accessors.classes).bind(this)).attr("x1",d4.functor(e.accessors.x1).bind(this)).attr("x2",d4.functor(e.accessors.x2).bind(this)).attr("y1",d4.functor(e.accessors.y1).bind(this)).attr("y2",d4.functor(e.accessors.y2).bind(this));return n}}})}.call(this),function(){/*!
   * global d3: false
   * global d4: false
   */
/*!
    Column connectors helpful when displaying a stacked column chart.
    A connector will not connect positve and negative columns. This is because
    in a stacked column a negative column may move many series below its previous
    location. This creates a messy collection of crisscrossing lines.
  */
"use strict";d4.feature("stackedColumnConnectors",function(t){var e=function(t){return t?0>t?-1:1:0},n=function(t,n,r){return e(t[r])===e(n[r])},r=function(t,e,r,s,i){var a="ordinal"===this.y.$scale?this.x.$key:this.y.$key;return 0!==e&&n(s[r].values[e-1],t,a)?i.bind(this)():0};return{accessors:{x1:function(t){return"ordinal"===this.x.$scale?this.x(t[this.x.$key]):this.x(t.y0+t.y)},y1:function(t){return"ordinal"===this.y.$scale?this.y(t[this.y.$key]):this.y(t.y0+t.y)},size:function(){return"ordinal"===this.x.$scale?this.x.rangeBand():this.y.rangeBand()},classes:function(t,e){return"series"+e}},render:function(e,n){this.featuresGroup.append("g").attr("class",t);var s=this.svg.select("."+t).selectAll("g").data(n).enter().append("g").attr("class",function(t,e){return"series"+e+" "+this.y.$key}.bind(this)),i=s.selectAll("lines").data(function(t){return t.values}.bind(this));return i.enter().append("line"),i.exit().remove(),i.attr("class",d4.functor(e.accessors.classes).bind(this)).attr("stroke-dasharray","5, 5").attr("x1",function(t,s,i){return r.bind(this)(t,s,i,n,function(){return d4.functor(e.accessors.x1).bind(this)(t)})}.bind(this)).attr("y1",function(t,s,i){var a="ordinal"===this.y.$scale?d4.functor(e.accessors.size).bind(this)(t):0;return r.bind(this)(t,s,i,n,function(){return d4.functor(e.accessors.y1).bind(this)(t)+a})}.bind(this)).attr("x2",function(t,s,i){var a="ordinal"===this.x.$scale?e.accessors.size.bind(this)(t):0;return r.bind(this)(t,s,i,n,function(){return d4.functor(e.accessors.x1).bind(this)(n[i].values[s-1])+a})}.bind(this)).attr("y2",function(t,s,i){return r.bind(this)(t,s,i,n,function(){return d4.functor(e.accessors.y1).bind(this)(n[i].values[s-1])})}.bind(this)),i}}})}.call(this),function(){/*!
   * global d3: false
   * global d4: false
   */
"use strict";d4.feature("stackedColumnLabels",function(t){var e=function(t){return t.y0!==void 0?!0:"ordinal"!==this.y.$scale?!0:!1},n=function(t){return e.bind(this)(t)?"middle":"start"},r=function(t,e){var n=this[t];return n(e[n.$key])+n.rangeBand()/2},s=function(t,e){var n,r=this[t],s=Math.abs(r(e.y0)-r(e.y0+e.y))/2,i=5;return"x"===t&&(s*=-1,i*=-1),e.y0!==void 0?(n=e.y0+e.y,(0>=n?r(e.y0):r(n))+s):(0>=e[r.$key]?r(0):r(e[r.$key]))-i};return{accessors:{x:function(t){return"ordinal"===this.x.$scale?r.bind(this)("x",t):s.bind(this)("x",t)},y:function(t){return"ordinal"===this.y.$scale?r.bind(this)("y",t):s.bind(this)("y",t)},text:function(t){if(void 0===t.y0)return d3.format("").call(this,t[this.valueKey]);if("ordinal"===this.x.$scale){if(Math.abs(this.y(t.y0)-this.y(t.y0+t.y))>20)return d3.format("").call(this,t[this.valueKey])}else if(Math.abs(this.x(t.y0)-this.x(t.y0+t.y))>20)return d3.format("").call(this,t[this.valueKey])},stagger:!0,classes:"column-label"},render:function(e,r){this.featuresGroup.append("g").attr("class",t);var s=this.svg.select("."+t).selectAll("g").data(r,function(t,e){return t.key+e});s.enter().append("g").attr("class",function(t,e){return"series"+e+" "+this.x.$key}.bind(this)),s.exit().remove();var i=s.selectAll("text").data(function(t){return t.values}.bind(this));return i.exit().remove(),i.enter().append("text").text(d4.functor(e.accessors.text).bind(this)).attr("text-anchor",n.bind(this)).attr("class",d4.functor(e.accessors.classes).bind(this)).attr("y",d4.functor(e.accessors.y).bind(this)).attr("x",d4.functor(e.accessors.x).bind(this)),d4.functor(e.accessors.stagger).bind(this)()&&("ordinal"!==this.y.$scale?s.selectAll("text").call(d4.helpers.staggerTextVertically,-1):s.selectAll("text").call(d4.helpers.staggerTextHorizontally,1)),i}}})}.call(this),function(){/*!
   * global d3: false
   * global d4: false
   */
"use strict";d4.feature("stackedColumnSeries",function(t){var e=function(t){return t>0?"positive":"negative"},n=function(t,e){var n=this[t];return n(e[n.$key])},r=function(t){var e=this[t];return e.rangeBand()},s=function(t,e){var n=this[t];return e.y0!==void 0?Math.abs(n(e.y0)-n(e.y0+e.y)):Math.abs(n(e[n.$key])-n(0))},i=function(t,e){var n,r=this[t];return e.y0!==void 0?"y"===t?(n=e.y0+e.y,0>n?r(e.y0):r(n)):(n=e.y0+e.y-Math.max(0,e.y),r(n)):"y"===t?0>e[r.$key]?r(0):r(e[r.$key]):(n=e[r.$key]-Math.max(0,e[r.$key]),r(n))};return{accessors:{classes:function(t,n){return"bar fill item"+n+" "+e(t[this.valueKey])+" "+t[this.y.$key]},height:function(t){return"ordinal"===this.y.$scale?r.bind(this)("y"):s.bind(this)("y",t)},rx:0,ry:0,width:function(t){return"ordinal"===this.x.$scale?r.bind(this)("x"):s.bind(this)("x",t)},x:function(t){return"ordinal"===this.x.$scale?n.bind(this)("x",t):i.bind(this)("x",t)},y:function(t){return"ordinal"===this.y.$scale?n.bind(this)("y",t):i.bind(this)("y",t)}},render:function(e,n){this.featuresGroup.append("g").attr("class",t);var r=this.svg.select("."+t).selectAll("g").data(n,function(t,e){return t.key+e});r.enter().append("g").attr("class",function(t,e){return"series"+e+" "+this.y.$key}.bind(this)),r.exit().remove();var s=r.selectAll("rect").data(function(t){return t.values});return s.enter().append("rect").attr("class",d4.functor(e.accessors.classes).bind(this)).attr("x",d4.functor(e.accessors.x).bind(this)).attr("rx",d4.functor(e.accessors.rx).bind(this)()).attr("y",d4.functor(e.accessors.y).bind(this)).attr("ry",d4.functor(e.accessors.ry).bind(this)()).attr("width",d4.functor(e.accessors.width).bind(this)).attr("height",d4.functor(e.accessors.height).bind(this)),s.exit().remove(),s}}})}.call(this),function(){/*!
   * global d3: false
   * global d4: false
   */
"use strict";d4.feature("trendLine",function(t){return{accessors:{x1:function(){return this.x(0)},x2:function(){return this.x(this.width)},y1:function(){return this.y(0)},y2:function(){return this.y(this.height)},text:function(t){return d3.format("").call(this,t[1])},textX:function(){return this.x(this.width)},textY:function(){return this.x(this.height)}},render:function(e){var n=this.svg.select("defs");n.append("marker").attr("id",t+"-start").attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerWidth",-6).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z"),this.featuresGroup.append("g").attr("class",t);var r=this.svg.select("."+t).append("line").attr("class","line").attr("x1",d4.functor(e.accessors.x1).bind(this)).attr("x2",d4.functor(e.accessors.x2).bind(this)).attr("y1",d4.functor(e.accessors.y1).bind(this)).attr("y2",d4.functor(e.accessors.y2).bind(this)).attr("marker-end","url(#"+t+"-start)");return this.svg.select("."+t).append("text").attr("class","trendLine-label").text(d4.functor(e.accessors.text).bind(this)).attr("x",d4.functor(e.accessors.textX).bind(this)).attr("y",d4.functor(e.accessors.textY).bind(this)),r}}})}.call(this),function(){"use strict";/*!
   * global d3: false
   * global d4: false
   */
d4.feature("waterfallConnectors",function(t){return{accessors:{x:function(t){if("linear"===this.x.$scale){var e=0,n=t.y0+t.y-Math.max(0,t.y);return t.y>0&&(e=Math.abs(this.x(t.y0)-this.x(t.y0+t.y))),this.x(n)+e}return this.x(t[this.x.$key])},y:function(t){return"linear"===this.x.$scale?this.y(t[this.y.$key]):this.y(t.y0+t.y)},span:function(){return"linear"===this.x.$scale?this.y.rangeBand():this.x.rangeBand()},classes:function(t,e){return"series"+e}},render:function(e,n){this.featuresGroup.append("g").attr("class",t);var r=this.svg.select("."+t).selectAll("."+t).data(function(t){return t.map(function(t){return t.values[0]})}.bind(this));return r.enter().append("line"),r.exit().remove(),r.attr("class",d4.functor(e.accessors.classes).bind(this)).attr("x1",function(t,r){return 0===r?0:d4.functor(e.accessors.x).bind(this)(n[r-1].values[0])}.bind(this)).attr("y1",function(t,r){return 0===r?0:d4.functor(e.accessors.y).bind(this)(n[r-1].values[0])}.bind(this)).attr("x2",function(t,r){return 0===r?0:"ordinal"===this.x.$scale?d4.functor(e.accessors.x).bind(this)(t)+d4.functor(e.accessors.span).bind(this)():d4.functor(e.accessors.x).bind(this)(n[r-1].values[0])}.bind(this)).attr("y2",function(t,r){return 0===r?0:"ordinal"===this.x.$scale?d4.functor(e.accessors.y).bind(this)(n[r-1].values[0]):d4.functor(e.accessors.y).bind(this)(t)+d4.functor(e.accessors.span).bind(this)(t)}.bind(this)),r}}})}.call(this),function(){/*!
   * global d3: false
   * global d4: false
   */
"use strict";d4.feature("xAxis",function(t){var e=d3.svg.axis().orient("bottom").tickSize(0),n=function(t,e){var n=d4.helpers.textSize(t,e);return n.text=t,n},r=function(t,e,n){if(t.text){var r=this.svg.selectAll(".x.axis"),s=r.node().getBBox(),i=.8*t.height,a=r.append("text").text(t.text).attr("class",""+n);"bottom"===e.toLowerCase()?a.attr("transform","translate(0,"+(s.height+i)+")"):a.attr("transform","translate(0,"+(s.y-i/2)+")")}},s=function(t,e){switch(!0){case"top"===t.toLowerCase():e.attr("transform","translate(0,0)");break;case"bottom"===t.toLowerCase():e.attr("transform","translate(0,"+this.height+")")}},i={accessors:{stagger:!0,subtitle:void 0,title:void 0,align:"bottom"},proxies:[e],render:function(i){i.scale(this.x);var a=n(d4.functor(i.accessors.title).bind(this)(),"title"),c=n(d4.functor(i.accessors.subtitle).bind(this)(),"subtitle"),u=d4.functor(i.accessors.align).bind(this)(),o=this.featuresGroup.append("g").attr("class","x axis "+t).call(e);s.bind(this)(u,o),d4.functor(i.accessors.stagger).bind(this)()&&o.selectAll(".tick text").call(d4.helpers.staggerTextVertically,1),"top"===u?(r.bind(this)(c,u,"subtitle"),r.bind(this)(a,u,"title")):(r.bind(this)(a,u,"title"),r.bind(this)(c,u,"subtitle"))}};return i})}.call(this),function(){/*!
   * global d3: false
   * global d4: false
   */
"use strict";/*!
   * FIXME: There is a lot of similarity between the x and y axis features, it would be
   * great to combine these two.
   */
d4.feature("yAxis",function(t){var e=d3.svg.axis().orient("left").tickSize(0),n=function(t,e){var n=d4.helpers.textSize(t,e);return n.text=t,n},r=function(t,e,n){if(t.text){var r=this.svg.selectAll(".y.axis"),s=r.node().getBBox(),i=.8*t.height,a=r.append("text").text(t.text).attr("class",""+n);"left"===e.toLowerCase()?a.call(d4.helpers.rotateText("rotate(90)translate(0,"+(Math.abs(s.x)+i)+")")):a.call(d4.helpers.rotateText("rotate(90)translate(0,"+(Math.abs(s.x)-(s.width+i))+")"))}},s=function(t,e){switch(!0){case"left"===t.toLowerCase():e.attr("transform","translate(0,0)");break;case"right"===t.toLowerCase():e.attr("transform","translate("+this.width+", 0)")}},i={accessors:{stagger:!0,subtitle:void 0,title:void 0,align:"left"},proxies:[e],render:function(i){i.scale(this.y);var a=n(d4.functor(i.accessors.title).bind(this)(),"title"),c=n(d4.functor(i.accessors.subtitle).bind(this)(),"subtitle"),u=d4.functor(i.accessors.align).bind(this)(),o=this.featuresGroup.append("g").attr("class","y axis "+t).call(e);o.selectAll(".tick text").call(d4.helpers.wrapText,this.margin[u]),s.bind(this)(u,o),d4.functor(i.accessors.stagger).bind(this)()&&this.svg.selectAll(".y.axis .tick text").call(d4.helpers.staggerTextHorizontally,-1),"left"===u?(r.bind(this)(a,u,"title"),r.bind(this)(c,u,"subtitle")):(r.bind(this)(c,u,"subtitle"),r.bind(this)(a,u,"title"))}};return i})}.call(this),function(){/*! global d3: false */
/*! global d4: false */
"use strict";d4.parser("nestedGroup",function(){var t={x:{key:"x",values:[]},y:{key:"y",values:[]},value:{key:"value",values:[]},data:[]};t.nestKey=function(){return t.x.key};var e=function(e,n){["x","y","value"].forEach(function(r){var s=n.map(function(t){return t[e[r].key]});t[r].values=d3.set(s).values()})},n=function(t,e,n){var r=d3.nest().key(function(e){return e[t]});return r.entries(n)},r=function(e,n){t[e].key=d4.functor(n)()},s=function(r){return r&&d4.extend(t.data,r),e(t,t.data),t.data=n(t.nestKey(),t.value.key,t.data),t};return s.nestKey=function(e){return t.nestKey=d4.functor(e).bind(t),s},s.x=function(e){return r.bind(t)("x",e),s},s.y=function(e){return r.bind(t)("y",e),s},s.value=function(e){return r.bind(t)("value",e),s},s})}.call(this),function(){/*! global d3: false */
/*! global d4: false */
"use strict";d4.parser("nestedStack",function(){var t={x:{key:"x",values:[]},y:{key:"y",values:[]},value:{key:"value",values:[]},data:[]},e=function(e,n){["x","y","value"].forEach(function(r){var s=n.map(function(t){return t[e[r].key]});t[r].values=d3.set(s).values()})},n=function(t,e,n){var r=d3.nest().key(function(e){return e[t]});return r.entries(n)},r=function(e,n){var r={},s=d3.layout.stack().values(function(t){return t.values}).x(function(t){return t[e]}).y(function(e){return+e[t.value.key]}).out(function(t,n,s){t.y=s,t.y>=0?(t.y0=r[t[e]+"Pos"]=r[t[e]+"Pos"]||0,r[t[e]+"Pos"]+=s):(t.y0=r[t[e]+"Neg"]=r[t[e]+"Neg"]||0,r[t[e]+"Neg"]-=Math.abs(s))});s(n.reverse())},s=function(e,n){t[e].key=d4.functor(n)()},i=function(s){return s&&d4.extend(t.data,s),e(t,t.data),t.data=n(t.y.key,t.value.key,t.data),r(t.x.key,t.data),t};return i.x=function(e){return s.bind(t)("x",e),i},i.y=function(e){return s.bind(t)("y",e),i},i.value=function(e){return s.bind(t)("value",e),i},i})}.call(this),function(){/*! global d3: false */
/*! global d4: false */
"use strict";d4.parser("waterfall",function(){var t={x:{key:"x",values:[]},y:{key:"y",values:[]},value:{key:"value",values:[]},data:[]};t.nestKey=function(){return t.x.key};var e=function(e,n){["x","y","value"].forEach(function(r){var s=n.map(function(t){return t[e[r].key]});t[r].values=d3.set(s).values()})},n=function(t,e,n){var r=d3.nest().key(function(e){return e[t]});return r.entries(n)},r=function(e,n){var r=0,s=function(t){return isNaN(t)?0:t},i=d3.layout.stack().values(function(t){return t.values}).x(function(t){return t[e]}).y(function(e){return+e[t.value.key]}).out(function(e,n,i){isNaN(i)?(isNaN(n)&&(n=r),e.y0=0,e.y=n,e[t.value.key]=n,r=n):(isNaN(n)?(e.y0=r,r+=i):e.y0=n,e.y=i,e[t.value.key]=s(e[t.value.key]))});i(n)},s=function(e,n){t[e].key=d4.functor(n)()},i=function(s){return s&&d4.extend(t.data,s),e(t,t.data),t.data=n(t.nestKey(),t.value.key,t.data),r(t.x.key,t.data),t};return i.nestKey=function(e){return t.nestKey=d4.functor(e).bind(t),i},i.x=function(e){return s.bind(t)("x",e),i},i.y=function(e){return s.bind(t)("y",e),i},i.value=function(e){return s.bind(t)("value",e),i},i})}.call(this),function(){/*!
   * global d3: false
   * global d4: false
   */
"use strict";var t=function(t,e){var n=t.map(function(t){return t.values.map(function(t){return t[e]}.bind(this))}.bind(this));return d3.merge(n)},e=function(t,e){switch(e){case"x":return[0,t.width];case"y":return[t.height,0];default:return[]}};d4.builder("linearScaleForNestedData",function(t,n,r){var s=t[r].$key,i=d3.extent(d3.merge(n.map(function(t){return d3.extent(t.values,function(t){return t[s]+(t.y0||0)})}))),a=t[r];return a.domain.$dirty||a.domain([Math.min(a.$min||0,i[0]),a.$max||i[1]]),a.range.$dirty||a.range(e(t,r)),a.clamp.$dirty||a.clamp(!0),t[r].nice()}),d4.builder("ordinalScaleForNestedData",function(n,r,s){var i=t(r,n[s].$key),a=n[s+"RoundBands"]=n[s+"RoundBands"]||.3,c=n[s];return c.domain.$dirty||c.domain(i),c.rangeRoundBands.$dirty||c.rangeRoundBands(e(n,s),a),c})}.call(this);